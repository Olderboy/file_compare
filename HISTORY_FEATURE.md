# 历史记录功能说明

## 功能概述

测试结果合并对比工具现在支持历史记录功能，可以自动保存和加载之前的合并操作记录。

## 主要功能

### 1. 自动保存历史记录
- 每次成功合并后自动保存到历史记录
- 记录内容包括：
  - 📅 时间戳
  - 📁 使用的文件（左侧和右侧）
  - ⚙️ 配置参数（列后缀、统计列配置等）
  - 💾 输出文件路径
- 最多保存 10 条历史记录

### 2. 查看历史记录
- 点击界面底部的 **"📜 历史记录"** 按钮
- 弹出历史记录窗口，显示所有历史记录
- 每条记录显示：
  - 时间戳
  - 左侧文件列表（最多显示前3个）
  - 右侧文件列表（最多显示前3个）

### 3. 加载历史记录
- 在历史记录窗口中点击 **"📂 加载此记录"** 按钮
- 自动恢复：
  - ✅ 文件列表（左侧和右侧）
  - ✅ 配置参数（列后缀、统计列等）
  - ✅ 输出文件路径
- 如果文件不存在，会自动跳过

### 4. 删除历史记录
- **单条删除**：在历史记录窗口中点击 **"🗑️ 删除"** 按钮删除单条记录
- **清空全部**：点击界面底部的 **"🗑️ 清空历史"** 按钮清空所有历史记录

## 历史记录文件

- **文件位置**：`.merge_history.json`（与 `merge_gui.py` 同目录）
- **文件格式**：JSON
- **文件示例**：
```json
{
  "records": [
    {
      "timestamp": "2025-01-18 10:30:15",
      "left_files": ["test1.xlsx", "test2.xlsx"],
      "left_paths": ["E:\\Work\\数据文件2\\test1.xlsx"],
      "right_files": ["test3.xlsx"],
      "right_paths": ["E:\\Work\\数据文件2\\test3.xlsx"],
      "output_file": "D:\\output\\result.csv",
      "config": {
        "left_suffix": "gauss",
        "right_suffix": "sr",
        "numeric_columns": "TotalTimeCount,DownloadFileTime",
        "original_only_columns": "FileCount",
        "custom_separator_columns": "EndTimeRecord:||"
      }
    }
  ]
}
```

## 使用场景

### 场景 1：重复执行相同的合并操作
1. 第一次合并完成后，系统自动保存历史记录
2. 下次需要执行相同操作时：
   - 点击 **"📜 历史记录"**
   - 找到对应的记录
   - 点击 **"📂 加载此记录"**
   - 点击 **"🚀 开始合并"**

### 场景 2：对比不同配置的结果
1. 使用配置 A 合并数据 → 自动保存到历史记录
2. 修改配置为配置 B 再次合并 → 再次保存
3. 可以随时加载历史记录中的配置，快速对比不同配置的结果

### 场景 3：团队协作
- 将 `.merge_history.json` 文件分享给团队成员
- 团队成员可以加载你的历史记录，复现你的合并操作

## 注意事项

1. **文件路径**：历史记录保存的是绝对路径，如果移动了文件，加载时会跳过不存在的文件
2. **历史记录数量**：默认最多保存 10 条，超过后会自动删除最旧的记录
3. **隐私保护**：历史记录文件包含文件路径信息，请勿分享给不相关的人员
4. **备份建议**：定期备份 `.merge_history.json` 文件，以免丢失历史记录

## 测试历史记录功能

运行测试脚本创建示例历史记录：

```bash
python test_history.py
```

然后启动 GUI：

```bash
python merge_gui.py
```

点击界面底部的 **"📜 历史记录"** 按钮查看加载的历史记录。

## 技术实现

### 数据结构
- 使用 Python 字典存储历史记录
- JSON 格式持久化到文件
- 使用 `datetime` 模块生成时间戳

### 核心方法
- `load_history()` - 从文件加载历史记录
- `save_history()` - 保存历史记录到文件
- `add_to_history()` - 添加新的历史记录
- `load_history_record()` - 加载指定的历史记录
- `show_history_dialog()` - 显示历史记录对话框
- `delete_history_record()` - 删除单条历史记录
- `clear_history()` - 清空所有历史记录

### UI 组件
- 历史记录窗口：`Toplevel` 窗口
- 滚动区域：`Canvas` + `Scrollbar`
- 历史记录项：自定义 `Frame` 布局
- 按钮样式：扁平化设计，悬停效果
